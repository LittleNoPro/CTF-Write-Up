from Crypto.Util.number import *
from sage.all import *
from Crypto.Cipher import AES
import hashlib

p = 29488186972994534670417457155366645471182192199548659526413766939622361834146838276946251349867903845037032661551684336383382344530884181161185642157078150688387732468939373900371006578051481214072847442197503071055434360628659838236532690198978142021175339546919178335298684316724700262657029112644393293166154034921906788597061578283700388736429770020977264432345664045738339856555098074820929368834732846308848389109185416718414806791898185843424928326488893410923833562473301321779917349894586830655477919639150483605307802684111768011681546150738863663345823398017514538698657196101072867671246153807653084849979
g = 0x10001
a = 15565989507023520599989453473844888345738293883767540044682200387116098778726727092639584680030282924680754836996824347666944190568219259972559913371376230295642182212369433729563762217727277805412925981228881460051783217872389120277083233191144941820776264906459152636385581608797345048727329767042394346810437890763454382771288788698625345149261169962034579205221557431869735207318556427897861682927352582426356093597283783347686188442927706115209934983043745580341869373867823516184740079142532925105289504694660421450970265051590438438057830106683050024773068164385422394299956145634093724572089312716467972923242
ord = p - 1
factors = [2, 15739, 16193, 34146337, 34969303, 34996979, 35882111, 36235453, 36253411, 36425761, 36699737, 37482199, 38138383, 38335727, 38523971, 40124191, 41442881, 42039769, 43915397, 44131229, 44386523, 44601737, 44918989, 45234109, 47471797, 47549387, 47614939, 47685917, 48562117, 49424983, 49518451, 49592497, 51053143, 51603091, 51944203, 53274623, 53720993, 53812277, 53963431, 54074849, 54156757, 54161383, 54784601, 54825247, 55148501, 56594249, 58469773, 59463269, 60129947, 60522233, 60733993, 60796577, 61309427, 61975691, 62113789, 62556521, 62747701, 63628133, 64570157, 64974397, 65424053, 66279959, 7460499821685332157113516060069886564400427229472624761209683142140995510658080396491764993046100641019523524398412618076429841989075435122250235698035949]

K = GF(p)
res = []
for i in factors[:-1]:
    g_i = K(pow(g, ord // i, p))
    a_i = K(pow(a, ord // i, p))
    order = ZZ(i)
    x = discrete_log(a_i, g_i, ord=order)
    res.append(x)

x = crt(res, factors[:-1])

# Solve large factor
large_factor = factors[-1]
FF = GF(p)
g = FF(g)
h = FF(a)

while pow(g, x, p) != h:
    x += p // large_factor

# Find flag
flag = b'\x15\xa5(l\xa3\xaar\xcd\xf0cN\ti\x12\xb8\x9fB\x82\xd3N\x86\x05\xa1\xb1\x82\xc4\xe1\x17vf\x0e,'
key = hashlib.sha512(long_to_bytes(x)).digest()[:16]
cipher = AES.new(key, AES.MODE_ECB)
flag = cipher.decrypt(flag)
print(flag)

# Flag: W1{1t_1s_sm00th_bu7_n07_3n0ugh!}